<h3>Почему не работает...</h3>
<p><i>Q: Почему неичего не работает?</i></p>
A: Потому, что для работы нужен правильный файл конфигурации.

<p><i>Q: Почему не работают ограничения доступа (перенаправления, ограничения по скорости,
трафику и т.д.)</i></p>
A: обычные ошибки - использование auth none (для работы любых
функций основанных на ACL требуется auth iponly, nbname или strong),
нарушение порядка ввода команд (команды выполняются последовательно,
запуск сервиса proxy, socks, tcppm и т.д. должен осуществляться после
того, как указана его конфигурация), неправильный порядок записей в ACL
(записи просматриваются последовательно до первой удовлетворяющей
критериям). Если в ACL имеется хотя бы одна запись, то считается, что
последняя запись в ACL это неявная deny *.

<p><i>Q: Почему не работает ведение журналов в ODBC?</i></p>
A: Убедитесь, что выполняется правильный SQL запрос. Наиболее
распространенная проблема связана с отсутствием кавычек или неправильным
форматом данных. Самый простой способ - сделать ведение журнала в файл или
на стандартный вывод, просмотреть выдаваемые SQL запросы и попробовать
дать такой запрос вручную.

<p><i>Q: Почему 3proxy не запускается как служба?</i></p>
A: Наиболее вероятные причины - отсутствие команды service в конфигурации
или использование относительных (неполных) путей файлов в файле конфигурации.
При использовании файлов журналов, файлов вставок ($filename) используйте
полные пути, например $"c:\3proxy\include files\networks.local".
Для отладки лучше запускать 3proxy с ведением журнала на стандартный вывод.
Не забудьте в таком случае отключить daemon и service в файле конфигурации.
Для чистоты эксперимента запускать 3proxy из коммандной строки в таком случае
следут находясь в другой папке.

<p><i>Q: Почему не поддерживаются APOP и CRAM-MD5 в POP3 прокси?</i></p>
A: Любая challenge-response аутентификация, к которым относятся APOP
и CRAM-MD5, требует, чтобы со стороны сервера был передан уникальный challenge.
До начала аутентификации, POP3 прокси не знает к какому серверу следует
подключаться для получения Challenge, поэтому challenge-response в принципе
невозможен. Защитить соединение можно с помощью TLS (например stunnel) или
IPSec.

<h3>Перенаправление socks соединений в локальный прокси</h3>
<p><i>Q: Для чего это надо?</i></p>
A: Чтобы  иметь в логах URL запросов если пользователь SOCKS пользуется
Web, FTP или POP3

<p><i>Q: Какие недостатки?</i></p>
A: Перенапраление  невозможно для web-серверов или FTP висящих на
нестандартных портах,  для SOCKSv4 не поддрживается авторизация  с
паролем  (IE  поддерживает  только SOCKSv4), но при этом IE  передает
имя  пользователя  по  SOCKSv4 (имя с которым пользователь вошел в систему).
Для SOCKSv5 не поддерживается NTLM авторизация, пароли передаются в открытом
тексте.

<p><i>Q: Какие преимущества?</i></p>
A: Достаточно  в  настройках  IE  только  указать адрес SOCKS прокси. В
больших   сетях   можно  для  этого  использовать  WPAD  (автоматическое
обнаружение  прокси).  В  3proxy достаточно запускать только одну службу
(socks).   Если   используется   только   Internet  Explorer,  то  можно
автоматически   получать   имя   пользователя   в  логах  не  запрашивая
логин/пароль.

<p><i>Q: Как настраивается?</i></p>
A: Указывается parent http proxy со специальным адресом 0.0.0.0 и портом
0. Пример:
<pre>
allow * * * 80,8080-8088
parent 1000 http 0.0.0.0 0
allow * * * 80,8080-8088
#перенаправить соединения по портам 80 и 8080-8088 в локальный
#http прокси. Вторая команда allow необходима, т.к. контроль доступа
#осуществляется 2 раза - на уровне socks и на уровне HTTP прокси

allow * * * 21,2121
parent 1000 ftp 0.0.0.0 0
allow * * * 21,2121
#перенаправить соединения по портам 21 и 2121 в локальный
#ftp прокси


allow *
#пустить все соединения напрямую

socks
</pre>
<p><i>Q: как взаимодействует с другими правилами в ACL?</i></p>
A: После внутреннего перенаправления правила рассматриваются еще раз, за
исключением  самого правила с перенаправлением (т.е. обработка правил не
прекращается).  Это  позволяет  сделать  дальнейшие  перенаправления  на
внешний прокси. По этой же причине локальное перенаправление не должно
быть последним правилом (т.е. должно быть еще хотя бы правило allow
чтобы разрешить внешние соединения через HTTP прокси).
Например
<pre>
allow * * * 80,8080-8088
parent 1000 http 0.0.0.0 0
#перенаправить во внутренний прокси

allow * * $c:\3proxy\local.nets 80,8080-8088
#разрешить прямой web-доступ к сетям из local.nets
allow * * * 80,8080-8088
parent 1000 http proxy.sandy.ru 3128
#все остальные веб-запросы перенаправить на внешний прокси-сервер

allow *
#разрешить socks-запросы по другим портам
</pre>

<h3>А есть ли...</h3>

<p><i>
СМ> Существует ли сейчас поддержка FTP прокси в продукте.
</i></p>

Есть  поддержка  как FTP через HTTP (то что называется FTP прокси в Internet
Explorer, Netscape, Opera) так и настоящего FTP прокси (то что называется
FTP proxy в FAR и FTP клиентах).


<p><i>
СМ> Каким образом можно прибиндить сервисы на свой порт, к примеру HTTP
прокси к 8080 а не 3128 как по умолчанию.
</i></p>

proxy -p8080

<p><i>
СМ> Может плохо смотрел, но не увидел параметров отвечающих за ограничение
ширины канала.
</i></p>

Читайте HowTo <A HREF="http://www.security.nnov.ru/soft/3proxy/howtor.asp#BANDLIM">http://www.security.nnov.ru/soft/3proxy/howtor.asp#BANDLIM</A>

<h3>Почему так криво...</h3>
<p><i>Почему так криво считается трафик? Не совпадает с ...</i></p>
Следует учитывать, что 3proxy считает трафик только на прикладном уровне и
только проходящий через прокси-сервер. Провайдеры и другие средства учета
трафика считают трафик на сетевом уровне, что уже дает расхождение порядка 10%
за счет информации из заголовков пакетов. Кроме того, часть трафика, как
минимум DNS-разрешения, различный флудовый трафик и т.д. идут помимо прокси.
Уровень "шумового" трафика в Internet сейчас составляет порядка 50KB/день на
каждый реальный IP адрес, но может сильно варьироваться в зависимости от сети,
наличия открытых портов, реакции на ping-запросы и текущего уровня вирусной
активности. По этим причинам, если 3proxy используется чтобы не "выжрать"
трафик выделенный провайдером, всегда следует делать некий запас порядка
15%.
<p>
Если на одной с 3proxy машине имеются какие-либо сервисы или
работает пользователь - то их трафик не проходит через proxy-сервер и так же
не будет учтен. Если где-то есть NAT, то клиенты выходящие через NAT помимо
прокси так же останутся неучтенными. Если расхождение с провайдером превышает
10% - нужно искать причину именно в этом.
<p><i>Почему такая кривая конфигурация, и ничерта не понятно?</i></p>
Есть несколько причин. Во-первых до выхода релиза (т.е. версии 1.0) я буду изо
всех сил добиваться совместимости конфигурации между версиями. Во-вторых
конфигурация сделана так, чтобы ее можно было легко разбирать программно.
В-третьих все там понятно. При желании. Если знать как все работает.
<p><i>Почему так криво написан код, и ничерта не понятно?</i><p>
Есть несколько причин. Во-первых я не программист. Во-вторых 3proxy изначально
писался на коленке (в отет на &quot;слабо&quot; в одной из конференций). Никто
не мог предположить что им кто-то реально будет пользоваться. В-третьих у многих
возникает желание разобраться в коде 3proxy чтобы внедрить его в какой-нибудь
троян. Очень не хочется облегчать эту задачу. В-четвертых мне надо добиться
компиляции кода в как можно большем числе систем. Замечено, что чем кривее код в
C, тем он лучше переносится.
<p><i>Почему так много strcpy, sprintf и т.д., это ж дыры, ничерта не понятно?</i><p>
Есть несколько причин. Во-первых, несмотря на дурной тон использования этих
функций, они наиболее совместимы между разными системами и компиляторами.
Во-вторых само по себе их использование не означает присутствие дыры, если их
параметры должным образом контролируются. Найдете дыру - обязательно сообщите.
В третьих - может быть я уберу их перед конечным релизом чтобы никого не
пугать.

<pre>
$Id: faqr.html,v 1.9 2005/12/27 16:55:32 vlad Exp $
</pre>
